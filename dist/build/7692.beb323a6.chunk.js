(self.webpackChunkfindsolucoes_api_strapi=self.webpackChunkfindsolucoes_api_strapi||[]).push([[7692],{76539:(M,g,e)=>{"use strict";e.d(g,{Z:()=>y});var t=e(67294),p=e(53979),i=e(11047),o=e(29728),a=e(91134),r=e(85018),u=e(67109),T=e(45697),s=e.n(T),A=e(86896),n=e(30815),P=e(51319);const d=({onRegenerate:h,idToRegenerate:R,backUrl:W,onError:k})=>{const{formatMessage:I}=(0,A.Z)(),[D,L]=(0,t.useState)(!1),{regenerateData:B,isLoadingConfirmation:F}=(0,P.rW)(W,R,h,k),K=async()=>{B(),L(!1)};return t.createElement(t.Fragment,null,t.createElement(o.z,{startIcon:t.createElement(n.Z,null),type:"button",size:"S",variant:"tertiary",onClick:()=>L(!0),name:"regenerate"},I({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),t.createElement(a.QH,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:t.createElement(n.Z,null),isConfirmButtonLoading:F,isOpen:D,onToggleDialog:()=>L(!1),onConfirm:K,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};d.defaultProps={onRegenerate(){},onError:void 0},d.propTypes={onRegenerate:s().func,idToRegenerate:s().oneOfType([s().number,s().string]).isRequired,backUrl:s().string.isRequired,onError:s().func};const l=d,m=({title:h,token:R,setToken:W,canEditInputs:k,canRegenerate:I,isSubmitting:D,backUrl:L,regenerateUrl:B,onErrorRegenerate:F})=>{const{formatMessage:K}=(0,A.Z)(),Y=H=>{W({...R,accessKey:H})};return t.createElement(p.T,{title:R?.name||K(h),primaryAction:k?t.createElement(i.k,{gap:2},I&&R?.id&&t.createElement(l,{backUrl:B,onRegenerate:Y,idToRegenerate:R?.id,onError:F}),t.createElement(o.z,{disabled:D,loading:D,startIcon:t.createElement(r.Z,null),type:"submit",size:"S"},K({id:"global.save",defaultMessage:"Save"}))):I&&R?.id&&t.createElement(l,{onRegenerate:Y,idToRegenerate:R?.id,backUrl:B}),navigationAction:t.createElement(a.rU,{startIcon:t.createElement(u.Z,null),to:L},K({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};m.propTypes={token:s().shape({id:s().oneOfType([s().number,s().string]),type:s().string,lifespan:s().oneOfType([s().number,s().string]),name:s().string,accessKey:s().string,permissions:s().array,description:s().string,createdAt:s().string}),canEditInputs:s().bool.isRequired,canRegenerate:s().bool.isRequired,setToken:s().func.isRequired,isSubmitting:s().bool.isRequired,backUrl:s().string.isRequired,title:s().shape({id:s().string,label:s().string}).isRequired,regenerateUrl:s().string.isRequired,onErrorRegenerate:s().func},m.defaultProps={token:void 0,onErrorRegenerate:void 0};const y=m},60401:(M,g,e)=>{"use strict";e.d(g,{Z:()=>A});var t=e(67294),p=e(40619),i=e(82562),o=e(75515),a=e(45697),r=e.n(a),u=e(86896),T=e(75056);const s=({token:n,errors:P,values:d,onChange:l,isCreating:m})=>{const{formatMessage:y}=(0,u.Z)();return t.createElement(t.Fragment,null,t.createElement(p.P,{name:"lifespan",label:y({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:d.lifespan!==null?d.lifespan:"0",error:P.lifespan?y(P.lifespan?.id?P.lifespan:{id:P.lifespan,defaultMessage:P.lifespan}):null,onChange:h=>{l({target:{name:"lifespan",value:h}})},required:!0,disabled:!m,placeholder:"Select"},t.createElement(i.W,{value:"604800000"},y({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),t.createElement(i.W,{value:"2592000000"},y({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),t.createElement(i.W,{value:"7776000000"},y({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),t.createElement(i.W,{value:"0"},y({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),t.createElement(o.Z,{variant:"pi",textColor:"neutral600"},!m&&`${y({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,T.IX)(n?.createdAt,parseInt(d.lifespan,10))}`))};s.propTypes={errors:r().shape({lifespan:r().string}),onChange:r().func.isRequired,values:r().shape({lifespan:r().oneOfType([r().number,r().string])}).isRequired,isCreating:r().bool.isRequired,token:r().shape({id:r().oneOfType([r().number,r().string]),type:r().string,lifespan:r().string,name:r().string,accessKey:r().string,permissions:r().array,description:r().string,createdAt:r().string})},s.defaultProps={errors:{},token:{}};const A=s},24122:(M,g,e)=>{"use strict";e.d(g,{Z:()=>A});var t=e(67294),p=e(12028),i=e(91134),o=e(65186),a=e(69427),r=e(45697),u=e.n(r),T=e(86896);const s=({token:n,tokenType:P})=>{const{formatMessage:d}=(0,T.Z)(),l=(0,i.lm)(),{trackUsage:m}=(0,i.rS)(),{copy:y}=(0,i.VP)(),h=R=>async()=>{await y(R)&&(m.current("didCopyTokenKey",{tokenType:P}),l({type:"success",message:{id:"Settings.tokens.notification.copied"}}))};return t.createElement(i.Y_,{endAction:n&&t.createElement("span",{style:{alignSelf:"start"}},t.createElement(p.h,{label:d({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),onClick:h(n),noBorder:!0,icon:t.createElement(o.Z,null),style:{padding:0,height:"1rem"}})),title:n||d({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:d(n?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:t.createElement(a.Z,null),iconBackground:"neutral100"})};s.defaultProps={token:null},s.propTypes={token:u().string,tokenType:u().string.isRequired};const A=s},40695:(M,g,e)=>{"use strict";e.d(g,{Z:()=>u});var t=e(67294),p=e(61467),i=e(45697),o=e.n(i),a=e(86896);const r=({errors:T,values:s,onChange:A,canEditInputs:n})=>{const{formatMessage:P}=(0,a.Z)();return t.createElement(p.g,{label:P({id:"Settings.tokens.form.description",defaultMessage:"Description"}),id:"description",error:T.description?P(T.description?.id?T.description:{id:T.description,defaultMessage:T.description}):null,onChange:A,disabled:!n},s.description)};r.propTypes={errors:o().shape({description:o().string}),onChange:o().func.isRequired,canEditInputs:o().bool.isRequired,values:o().shape({description:o().string}).isRequired},r.defaultProps={errors:{}};const u=r},61053:(M,g,e)=>{"use strict";e.d(g,{Z:()=>u});var t=e(67294),p=e(16364),i=e(45697),o=e.n(i),a=e(86896);const r=({errors:T,values:s,onChange:A,canEditInputs:n})=>{const{formatMessage:P}=(0,a.Z)();return t.createElement(p.o,{name:"name",error:T.name?P(T.name?.id?T.name:{id:T.name,defaultMessage:T.name}):null,label:P({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:A,value:s.name,disabled:!n,required:!0})};r.propTypes={errors:o().shape({name:o().string}),onChange:o().func.isRequired,canEditInputs:o().bool.isRequired,values:o().shape({name:o().string}).isRequired},r.defaultProps={errors:{}};const u=r},31065:(M,g,e)=>{"use strict";e.d(g,{Z:()=>T});var t=e(67294),p=e(40619),i=e(82562),o=e(45697),a=e.n(o),r=e(86896);const u=({name:s,errors:A,values:n,onChange:P,canEditInputs:d,options:l,label:m})=>{const{formatMessage:y}=(0,r.Z)();return t.createElement(p.P,{name:s,label:y({id:m.id,defaultMessage:m.defaultMessage}),value:n&&n[s],error:A[s]?y(A[s]?.id?A[s]:{id:A[s],defaultMessage:A[s]}):null,onChange:P,placeholder:"Select",required:!0,disabled:!d},l&&l.map(({value:h,label:R})=>t.createElement(i.W,{key:h,value:h},y(R))))};u.propTypes={name:a().string,options:a().arrayOf(a().shape({label:a().shape({id:a().string,defaultMessage:a().string}),value:a().string})),errors:a().shape({type:a().string}),onChange:a().func.isRequired,canEditInputs:a().bool.isRequired,values:a().shape({type:a().string}).isRequired,label:a().shape({id:a().string,defaultMessage:a().string}).isRequired},u.defaultProps={name:"type",errors:{},options:[]};const T=u},47670:(M,g,e)=>{"use strict";e.d(g,{Z:()=>t,f:()=>p});const t="api-token",p="transfer-token"},57692:(M,g,e)=>{"use strict";e.d(g,{Z:()=>He});var t=e(67294),p=e(185),i=e(49066),o=e(11047),a=e(91134),r=e(41054),u=e(86896),T=e(88767),s=e(16550),A=e(45697),n=e.n(A);const P=(0,t.createContext)({}),d=({children:c,...E})=>t.createElement(P.Provider,{value:E},c),l=()=>(0,t.useContext)(P);d.propTypes={children:n().node.isRequired};var m=e(87751),y=e(19631),h=e(47670),R=e(76539),W=e(24122),k=e(41580),I=e(75515),D=e(11276),L=e(67819),B=e(60401),F=e(40695),K=e(61053),Y=e(31065);const H=({errors:c,onChange:E,canEditInputs:f,isCreating:S,values:x,apiToken:v,onDispatch:$,setHasChangedPermissions:V})=>{const{formatMessage:N}=(0,u.Z)(),z=({target:{value:j}})=>{V(!1),j==="full-access"&&$({type:"SELECT_ALL_ACTIONS"}),j==="read-only"&&$({type:"ON_CHANGE_READ_ONLY"})},J=[{value:"read-only",label:{id:"Settings.tokens.types.read-only",defaultMessage:"Read-only"}},{value:"full-access",label:{id:"Settings.tokens.types.full-access",defaultMessage:"Full access"}},{value:"custom",label:{id:"Settings.tokens.types.custom",defaultMessage:"Custom"}}];return t.createElement(k.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(I.Z,{variant:"delta",as:"h2"},N({id:"global.details",defaultMessage:"Details"})),t.createElement(D.r,{gap:5},t.createElement(L.P,{key:"name",col:6,xs:12},t.createElement(K.Z,{errors:c,values:x,canEditInputs:f,onChange:E})),t.createElement(L.P,{key:"description",col:6,xs:12},t.createElement(F.Z,{errors:c,values:x,canEditInputs:f,onChange:E})),t.createElement(L.P,{key:"lifespan",col:6,xs:12},t.createElement(B.Z,{isCreating:S,errors:c,values:x,onChange:E,token:v})),t.createElement(L.P,{key:"type",col:6,xs:12},t.createElement(Y.Z,{values:x,errors:c,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:j=>{z({target:{value:j}}),E({target:{name:"type",value:j}})},options:J,canEditInputs:f})))))};H.propTypes={errors:n().shape({name:n().string,description:n().string,lifespan:n().string,type:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({name:n().string,description:n().string,lifespan:n().oneOfType([n().number,n().string]),type:n().string}).isRequired,isCreating:n().bool.isRequired,apiToken:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().string,name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string}),onDispatch:n().func.isRequired,setHasChangedPermissions:n().func.isRequired},H.defaultProps={errors:{},apiToken:{}};const re=H;var X=e(53979),ee=e(29728),le=e(85018);const Q=({apiTokenName:c})=>{const{formatMessage:E}=(0,u.Z)();return(0,a.go)(),t.createElement(p.o,{"aria-busy":"true"},t.createElement(a.SL,{name:"API Tokens"}),t.createElement(X.T,{primaryAction:t.createElement(ee.z,{disabled:!0,startIcon:t.createElement(le.Z,null),type:"button",size:"L"},E({id:"global.save",defaultMessage:"Save"})),title:c||E({id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"})}),t.createElement(i.D,null,t.createElement(a.dO,null)))};Q.defaultProps={apiTokenName:null},Q.propTypes={apiTokenName:n().string};const de=Q;var ce=e(35161),te=e.n(ce),ne=e(13217),se=e.n(ne),ae=e(88972);const Ae=c=>{switch(c){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Ce=(0,ae.ZP)(k.x)`
  margin: -1px;
  border-radius: ${({theme:c})=>c.spaces[1]} 0 0 ${({theme:c})=>c.spaces[1]};
`;function pe({route:c}){const{formatMessage:E}=(0,u.Z)(),{method:f,handler:S,path:x}=c,v=x?se()(x.split("/")):[],[$="",V=""]=S?S.split("."):[],N=Ae(c.method);return t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},t.createElement(I.Z,{variant:"delta",as:"h3"},E({id:"Settings.apiTokens.createPage.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",t.createElement("span",null,$),t.createElement(I.Z,{variant:"delta",textColor:"primary600"},".",V)),t.createElement(o.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},t.createElement(Ce,{background:N.background,borderColor:N.border,padding:2},t.createElement(I.Z,{fontWeight:"bold",textColor:N.text},f)),t.createElement(k.x,{paddingLeft:2,paddingRight:2},te()(v,z=>t.createElement(I.Z,{key:z,textColor:z.includes(":")?"neutral600":"neutral900"},"/",z)))))}pe.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},pe.propTypes={route:n().shape({handler:n().string,method:n().string,path:n().string})};const Me=pe,xe=()=>{const{value:{selectedAction:c,routes:E}}=l(),{formatMessage:f}=(0,u.Z)(),S=c?.split(".")[0];return t.createElement(L.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},c?t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},E[S]?.map(x=>x.config.auth?.scope?.includes(c)||x.handler===c?t.createElement(Me,{key:x.handler,route:x}):null)):t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},t.createElement(I.Z,{variant:"delta",as:"h3"},f({id:"Settings.apiTokens.createPage.permissions.header.title",defaultMessage:"Advanced settings"})),t.createElement(I.Z,{as:"p",textColor:"neutral600"},f({id:"Settings.apiTokens.createPage.permissions.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))};var Oe=e(48734),Re=e(74756),De=e(63081),Te=e(36213),Ie=e(78114),Se=e(48403),ke=e.n(Se);const ve=(0,ae.iv)`
  background: ${c=>c.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,Le=(0,ae.ZP)(k.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${c=>c.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${c=>c.isActive&&ve}
  &:hover {
    ${ve}
  }
`,Be=ae.ZP.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:c})=>c.colors.neutral150};
`,ue=({controllers:c,label:E,orderNumber:f,disabled:S,onExpanded:x,indexExpandendCollapsedContent:v})=>{const{value:{onChangeSelectAll:$,onChange:V,selectedActions:N,setSelectedAction:z,selectedAction:J}}=l(),[j,oe]=(0,t.useState)(!1),{formatMessage:w}=(0,u.Z)(),b=()=>{oe(Z=>!Z),x(f)};(0,t.useEffect)(()=>{v!==null&&v!==f&&j&&oe(!1)},[v,f,j]);const _=Z=>Z===J;return t.createElement(Oe.U,{expanded:j,onToggle:b,variant:f%2?"primary":"secondary"},t.createElement(Re.B,{title:ke()(E)}),t.createElement(De.v,null,c?.map(Z=>{const ie=Z.actions.every(O=>N.includes(O.actionId)),Ee=Z.actions.some(O=>N.includes(O.actionId));return t.createElement(k.x,{key:`${E}.${Z?.controller}`},t.createElement(o.k,{justifyContent:"space-between",alignItems:"center",padding:4},t.createElement(k.x,{paddingRight:4},t.createElement(I.Z,{variant:"sigma",textColor:"neutral600"},Z?.controller)),t.createElement(Be,null),t.createElement(k.x,{paddingLeft:4},t.createElement(Te.X,{value:ie,indeterminate:!ie&&Ee,onValueChange:()=>{$({target:{value:[...Z.actions]}})},disabled:S},w({id:"app.utils.select-all",defaultMessage:"Select all"})))),t.createElement(D.r,{gap:4,padding:4},Z?.actions&&Z?.actions.map(O=>t.createElement(L.P,{col:6,key:O.actionId},t.createElement(Le,{isActive:_(O.actionId),padding:2,hasRadius:!0},t.createElement(Te.X,{value:N.includes(O.actionId),name:O.actionId,onValueChange:()=>{V({target:{value:O.actionId}})},disabled:S},O.action),t.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>z({target:{value:O.actionId}}),style:{display:"inline-flex",alignItems:"center"}},t.createElement(Ie.Z,null)))))))})))};ue.defaultProps={controllers:[],orderNumber:0,disabled:!1,onExpanded:()=>null,indexExpandendCollapsedContent:null},ue.propTypes={controllers:n().array,orderNumber:n().number,label:n().string.isRequired,disabled:n().bool,onExpanded:n().func,indexExpandendCollapsedContent:n().number};const Ue=ue,ge=({section:c,...E})=>{const[f,S]=(0,t.useState)(null),x=v=>S(v);return t.createElement(k.x,{padding:4,background:"neutral0"},c&&c.map((v,$)=>t.createElement(Ue,{key:v.apiId,label:v.label,controllers:v.controllers,orderNumber:$,indexExpandendCollapsedContent:f,onExpanded:x,name:v.apiId,...E})))};ge.defaultProps={section:null},ge.propTypes={section:n().arrayOf(n().object)};const be=ge,Ze=({...c})=>{const{value:{data:E}}=l(),{formatMessage:f}=(0,u.Z)();return t.createElement(D.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},t.createElement(L.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},t.createElement(I.Z,{variant:"delta",as:"h2"},f({id:"Settings.apiTokens.createPage.permissions.title",defaultMessage:"Permissions"})),t.createElement(I.Z,{as:"p",textColor:"neutral600"},f({id:"Settings.apiTokens.createPage.permissions.description",defaultMessage:"Only actions bound by a route are listed below."}))),E?.permissions&&t.createElement(be,{section:E?.permissions,...c})),t.createElement(xe,null))},We=(0,t.memo)(Ze);var me=e(75056);const Ke=(c,E=[])=>({...c,selectedAction:null,routes:[],selectedActions:[],data:(0,me.mk)(E)});var Ne=e(18172),$e=e(97019),Pe=e.n($e);const je={data:{},selectedActions:[]},Fe=(c,E)=>(0,Ne.ZP)(c,f=>{switch(E.type){case"ON_CHANGE":{f.selectedActions.includes(E.value)?Pe()(f.selectedActions,E.value):f.selectedActions.push(E.value);break}case"SELECT_ALL_IN_PERMISSION":{E.value.every(x=>f.selectedActions.includes(x.actionId))?E.value.forEach(x=>{Pe()(f.selectedActions,x.actionId)}):E.value.forEach(x=>{f.selectedActions.push(x.actionId)});break}case"SELECT_ALL_ACTIONS":{f.selectedActions=[...f.data.allActionsIds];break}case"ON_CHANGE_READ_ONLY":{const S=f.data.allActionsIds.filter(x=>x.includes("find")||x.includes("findOne"));f.selectedActions=[...S];break}case"UPDATE_PERMISSIONS_LAYOUT":{f.data=(0,me.mk)(E.value);break}case"UPDATE_ROUTES":{f.routes={...E.value};break}case"UPDATE_PERMISSIONS":{f.selectedActions=[...E.value];break}case"SET_SELECTED_ACTION":{f.selectedAction=E.value;break}default:return f}}),ze="Name already taken",He=()=>{(0,a.go)();const{formatMessage:c}=(0,u.Z)(),{lockApp:E,unlockApp:f}=(0,a.o1)(),S=(0,a.lm)(),x=(0,s.k6)(),[v,$]=(0,t.useState)(x.location.state?.apiToken.accessKey?{...x.location.state.apiToken}:null),{trackUsage:V}=(0,a.rS)(),N=(0,t.useRef)(V),{setCurrentStep:z}=(0,a.c1)(),{allowedActions:{canCreate:J,canUpdate:j,canRegenerate:oe}}=(0,a.ss)(m.Z.settings["api-tokens"]),[w,b]=(0,t.useReducer)(Fe,je,C=>Ke(C,{})),{params:{id:_}}=(0,s.$B)("/settings/api-tokens/:id"),{get:Z,post:ie,put:Ee}=(0,a.kY)(),O=_==="create";(0,T.useQuery)("content-api-permissions",async()=>{const[C,G]=await Promise.all(["/admin/content-api/permissions","/admin/content-api/routes"].map(async q=>{const{data:U}=await Z(q);return U.data}));b({type:"UPDATE_PERMISSIONS_LAYOUT",value:C}),b({type:"UPDATE_ROUTES",value:G}),v&&(v?.type==="read-only"&&b({type:"ON_CHANGE_READ_ONLY"}),v?.type==="full-access"&&b({type:"SELECT_ALL_ACTIONS"}),v?.type==="custom"&&b({type:"UPDATE_PERMISSIONS",value:v?.permissions}))},{onError(){S({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),(0,t.useEffect)(()=>{N.current(O?"didAddTokenFromList":"didEditTokenFromList",{tokenType:h.Z})},[O]);const{status:Ve}=(0,T.useQuery)(["api-token",_],async()=>{const{data:{data:C}}=await Z(`/admin/api-tokens/${_}`);return $({...C}),C?.type==="read-only"&&b({type:"ON_CHANGE_READ_ONLY"}),C?.type==="full-access"&&b({type:"SELECT_ALL_ACTIONS"}),C?.type==="custom"&&b({type:"UPDATE_PERMISSIONS",value:C?.permissions}),C},{enabled:!O&&!v,onError(){S({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),Ge=async(C,G)=>{N.current(O?"willCreateToken":"willEditToken",{tokenType:h.Z}),E();const q=C.lifespan&&parseInt(C.lifespan,10)&&C.lifespan!=="0"?parseInt(C.lifespan,10):null;try{const{data:{data:U}}=O?await ie("/admin/api-tokens",{...C,lifespan:q,permissions:C.type==="custom"?w.selectedActions:null}):await Ee(`/admin/api-tokens/${_}`,{name:C.name,description:C.description,type:C.type,permissions:C.type==="custom"?w.selectedActions:null});O&&(x.replace(`/settings/api-tokens/${U.id}`,{apiToken:U}),z("apiTokens.success")),f(),$({...U}),S({type:"success",message:c(O?{id:"notification.success.apitokencreated",defaultMessage:"API Token successfully created"}:{id:"notification.success.apitokenedited",defaultMessage:"API Token successfully edited"})}),N.current(O?"didCreateToken":"didEditToken",{type:v.type,tokenType:h.Z})}catch(U){const he=(0,y.Iz)(U.response.data);G.setErrors(he),U?.response?.data?.error?.message===ze?S({type:"warning",message:U.response.data.message||"notification.error.tokennamenotunique"}):S({type:"warning",message:U?.response?.data?.message||"notification.error"}),f()}},[Ye,fe]=(0,t.useState)(!1),Xe={...w,onChange:({target:{value:C}})=>{fe(!0),b({type:"ON_CHANGE",value:C})},onChangeSelectAll:({target:{value:C}})=>{fe(!0),b({type:"SELECT_ALL_IN_PERMISSION",value:C})},setSelectedAction:({target:{value:C}})=>{b({type:"SET_SELECTED_ACTION",value:C})}},ye=j&&!O||J&&O;return!O&&!v&&Ve!=="success"?t.createElement(de,{apiTokenName:v?.name}):t.createElement(d,{value:Xe},t.createElement(p.o,null,t.createElement(a.SL,{name:"API Tokens"}),t.createElement(r.J9,{validationSchema:me.fK,validateOnChange:!1,initialValues:{name:v?.name||"",description:v?.description||"",type:v?.type,lifespan:v?.lifespan?v.lifespan.toString():v?.lifespan},enableReinitialize:!0,onSubmit:(C,G)=>Ge(C,G)},({errors:C,handleChange:G,isSubmitting:q,values:U,setFieldValue:he})=>(Ye&&U?.type!=="custom"&&he("type","custom"),t.createElement(a.l0,null,t.createElement(R.Z,{backUrl:"/settings/api-tokens",title:{id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"},token:v,setToken:$,canEditInputs:ye,canRegenerate:oe,isSubmitting:q,regenerateUrl:"/admin/api-tokens/"}),t.createElement(i.D,null,t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:6},Boolean(v?.name)&&t.createElement(W.Z,{token:v?.accessKey,tokenType:h.Z}),t.createElement(re,{errors:C,onChange:G,canEditInputs:ye,isCreating:O,values:U,apiToken:v,onDispatch:b,setHasChangedPermissions:fe}),t.createElement(We,{disabled:!ye||U?.type==="read-only"||U?.type==="full-access"}))))))))}},75056:(M,g,e)=>{"use strict";e.d(g,{IX:()=>a,fK:()=>s,mk:()=>n});var t=e(66115),p=e(77349),i=e(51991);const a=(P,d,l="en")=>{if(d&&typeof d=="number"){const m=d/24/60/60/1e3;return(0,t.Z)((0,p.Z)(new Date(P),m),"PPP",{locale:i[l]})}return"Unlimited"};var r=e(91134),u=e(87561);const s=u.Ry().shape({name:u.Z_(r.I0.string).max(100).required(r.I0.required),type:u.Z_(r.I0.string).oneOf(["read-only","full-access","custom"]).required(r.I0.required),description:u.Z_().nullable(),lifespan:u.Rx().integer().min(0).nullable().defined(r.I0.required)}),n=P=>{const d={allActionsIds:[],permissions:[]};return d.permissions=Object.keys(P).map(l=>({apiId:l,label:l.split("::")[1],controllers:Object.keys(P[l].controllers).map(m=>({controller:m,actions:P[l].controllers[m].map(y=>{const h=`${l}.${m}.${y}`;return l.includes("api::")&&d.allActionsIds.push(h),{action:y,actionId:h}}).flat()})).flat()})),d}},41848:M=>{function g(e,t,p,i){for(var o=e.length,a=p+(i?1:-1);i?a--:++a<o;)if(t(e[a],a,e))return a;return-1}M.exports=g},42118:(M,g,e)=>{var t=e(41848),p=e(62722),i=e(42351);function o(a,r,u){return r===r?i(a,r,u):t(a,p,u)}M.exports=o},74221:M=>{function g(e,t,p,i){for(var o=p-1,a=e.length;++o<a;)if(i(e[o],t))return o;return-1}M.exports=g},62722:M=>{function g(e){return e!==e}M.exports=g},65464:(M,g,e)=>{var t=e(29932),p=e(42118),i=e(74221),o=e(7518),a=e(278),r=Array.prototype,u=r.splice;function T(s,A,n,P){var d=P?i:p,l=-1,m=A.length,y=s;for(s===A&&(A=a(A)),n&&(y=t(s,o(n)));++l<m;)for(var h=0,R=A[l],W=n?n(R):R;(h=d(y,W,h,P))>-1;)y!==s&&u.call(y,h,1),u.call(s,h,1);return s}M.exports=T},42351:M=>{function g(e,t,p){for(var i=p-1,o=e.length;++i<o;)if(e[i]===t)return i;return-1}M.exports=g},97019:(M,g,e)=>{var t=e(5976),p=e(45604),i=t(p);M.exports=i},45604:(M,g,e)=>{var t=e(65464);function p(i,o){return i&&i.length&&o&&o.length?t(i,o):i}M.exports=p},13217:(M,g,e)=>{var t=e(14259);function p(i){var o=i==null?0:i.length;return o?t(i,1,o):[]}M.exports=p},48734:(M,g,e)=>{"use strict";e.d(g,{U:()=>P,y:()=>A});var t=e(85893),p=e(67294),i=e(88972),o=e(13819),a=e(2504),r=e(75515),u=e(11047),T=e(41580);const s=({theme:d,expanded:l,variant:m,disabled:y,error:h})=>h?`1px solid ${d.colors.danger600} !important`:y?`1px solid ${d.colors.neutral150}`:l?`1px solid ${d.colors.primary600}`:m==="primary"?`1px solid ${d.colors.neutral0}`:`1px solid ${d.colors.neutral100}`,A=(0,i.ZP)(r.Z)``,n=(0,i.ZP)(T.x)`
  border: ${s};

  &:hover:not([aria-disabled='true']) {
    border: 1px solid ${({theme:d})=>d.colors.primary600};

    ${A} {
      color: ${({theme:d,expanded:l})=>l?void 0:d.colors.primary700};
    }

    ${r.Z} {
      color: ${({theme:d,expanded:l})=>l?void 0:d.colors.primary600};
    }

    & > ${u.k} {
      background: ${({theme:d})=>d.colors.primary100};
    }

    [data-strapi-dropdown='true'] {
      background: ${({theme:d})=>d.colors.primary200};
    }
  }
`,P=({children:d,disabled:l=!1,error:m,expanded:y=!1,hasErrorMessage:h=!0,id:R,onToggle:W,toggle:k,size:I="M",variant:D="primary",shadow:L})=>{const B=(0,a.M)(R),F=p.useMemo(()=>({expanded:y,onToggle:W,toggle:k,id:B,size:I,variant:D,disabled:l}),[l,y,B,W,I,k,D]);return(0,t.jsxs)(o.S.Provider,{value:F,children:[(0,t.jsx)(n,{"data-strapi-expanded":y,disabled:l,"aria-disabled":l,expanded:y,hasRadius:!0,variant:D,error:m,shadow:L,children:d}),m&&h&&(0,t.jsx)(T.x,{paddingTop:1,children:(0,t.jsx)(r.Z,{variant:"pi",textColor:"danger600",children:m})})]})}},63081:(M,g,e)=>{"use strict";e.d(g,{v:()=>o});var t=e(85893),p=e(13819),i=e(41580);const o=({children:a,...r})=>{const{expanded:u,id:T}=(0,p.A)();if(!u)return null;const s=`accordion-content-${T}`,A=`accordion-label-${T}`,n=`accordion-desc-${T}`;return(0,t.jsx)(i.x,{role:"region",id:s,"aria-labelledby":A,"aria-describedby":n,...r,children:a})}},13819:(M,g,e)=>{"use strict";e.d(g,{A:()=>i,S:()=>p});var t=e(67294);const p=(0,t.createContext)({disabled:!1,expanded:!1,id:"",size:"M",variant:"primary"}),i=()=>(0,t.useContext)(p)},74756:(M,g,e)=>{"use strict";e.d(g,{B:()=>d});var t=e(85893),p=e(12645),i=e(88972),o=e(48734),a=e(13819);const r=({expanded:l,disabled:m,variant:y})=>{let h="neutral100";return l?h="primary100":m?h="neutral150":y==="primary"&&(h="neutral0"),h};var u=e(39785),T=e(52624),s=e(11047),A=e(75515);const n=(0,i.ZP)(u.A)`
  text-align: left;

  // necessary to make the ellipsis prop work on the title
  > span {
    max-width: 100%;
  }

  svg {
    width: ${14/16}rem;
    height: ${14/16}rem;

    path {
      fill: ${({theme:l,expanded:m})=>m?l.colors.primary600:l.colors.neutral500};
    }
  }
`,P=(0,i.ZP)(s.k)`
  min-height: ${({theme:l,size:m})=>l.sizes.accordions[m]};
  border-radius: ${({theme:l,expanded:m})=>m?`${l.borderRadius} ${l.borderRadius} 0 0`:l.borderRadius};

  &:hover {
    svg {
      path {
        fill: ${({theme:l})=>l.colors.primary600};
      }
    }
  }
`,d=({title:l,description:m,as:y="span",togglePosition:h="right",action:R,...W})=>{const{onToggle:k,toggle:I,expanded:D,id:L,size:B,variant:F,disabled:K}=(0,a.A)(),Y=`accordion-content-${L}`,H=`accordion-label-${L}`,re=`accordion-desc-${L}`,X=B==="M"?6:4,ee=B==="M"?X:X-2,le=r({expanded:D,disabled:K,variant:F}),Q={as:y,fontWeight:B==="S"?"bold":void 0,id:H,textColor:D?"primary600":"neutral700",ellipsis:!0,variant:B==="M"?"delta":void 0},de=D?"primary600":"neutral600",ce=D?"primary200":"neutral200",te=B==="M"?`${32/16}rem`:`${24/16}rem`,ne=()=>{K||(I&&!k?(console.warn('Deprecation warning: Usage of "toggle" prop in Accordion component is deprecated. This is discouraged and will be removed in the next major release. Please use "onToggle" instead'),I()):k&&k())},se=(0,t.jsx)(s.k,{justifyContent:"center",borderRadius:"50%",height:te,width:te,transform:D?"rotate(180deg)":void 0,"data-strapi-dropdown":!0,"aria-hidden":!0,as:"span",background:ce,cursor:K?"not-allowed":"pointer",onClick:ne,shrink:0,children:(0,t.jsx)(T.J,{as:p.Z,width:B==="M"?`${11/16}rem`:`${8/16}rem`,color:D?"primary600":"neutral600"})});return(0,t.jsx)(P,{paddingBottom:ee,paddingLeft:X,paddingRight:X,paddingTop:ee,background:le,expanded:D,size:B,justifyContent:"space-between",cursor:K?"not-allowed":"",children:(0,t.jsxs)(s.k,{gap:3,flex:1,maxWidth:"100%",children:[h==="left"&&se,(0,t.jsx)(n,{onClick:ne,"aria-disabled":K,"aria-expanded":D,"aria-controls":Y,"aria-labelledby":H,"data-strapi-accordion-toggle":!0,expanded:D,type:"button",flex:1,minWidth:0,...W,children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.y,{...Q,children:l}),m&&(0,t.jsx)(A.Z,{as:"p",id:re,textColor:de,children:m})]})}),h==="right"&&(0,t.jsxs)(s.k,{gap:3,children:[se,R]}),h==="left"&&R]})})}}}]);
